"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1350],{4736:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var a=n(5773),i=(n(7378),n(5318)),o=n(6538);const r='import { OpenAI } from "langchain/llms";\nimport { ConversationalRetrievalQAChain } from "langchain/chains";\nimport { HNSWLib } from "langchain/vectorstores";\nimport { OpenAIEmbeddings } from "langchain/embeddings";\nimport { RecursiveCharacterTextSplitter } from "langchain/text_splitter";\nimport * as fs from "fs";\n\nexport const run = async () => {\n  /* Initialize the LLM to use to answer the question */\n  const model = new OpenAI({});\n  /* Load in the file we want to do question answering over */\n  const text = fs.readFileSync("state_of_the_union.txt", "utf8");\n  /* Split the text into chunks */\n  const textSplitter = new RecursiveCharacterTextSplitter({ chunkSize: 1000 });\n  const docs = await textSplitter.createDocuments([text]);\n  /* Create the vectorstore */\n  const vectorStore = await HNSWLib.fromDocuments(docs, new OpenAIEmbeddings());\n  /* Create the chain */\n  const chain = ConversationalRetrievalQAChain.fromLLM(\n    model,\n    vectorStore.asRetriever()\n  );\n  /* Ask it a question */\n  const question = "What did the president say about Justice Breyer?";\n  const res = await chain.call({ question, chat_history: [] });\n  console.log(res);\n  /* Ask it a follow up question */\n  const chatHistory = question + res.text;\n  const followUpRes = await chain.call({\n    question: "Was that nice?",\n    chat_history: chatHistory,\n  });\n  console.log(followUpRes);\n};\n',s={},l="ConversationalRetrievalQAChain",c={unversionedId:"modules/chains/index_related_chains/conversational_retrieval",id:"modules/chains/index_related_chains/conversational_retrieval",title:"ConversationalRetrievalQAChain",description:"The ConversationalRetrievalQA chain builds on RetrievalQAChain to provide a chat history component.",source:"@site/docs/modules/chains/index_related_chains/conversational_retrieval.mdx",sourceDirName:"modules/chains/index_related_chains",slug:"/modules/chains/index_related_chains/conversational_retrieval",permalink:"/langchainjs/docs/modules/chains/index_related_chains/conversational_retrieval",draft:!1,editUrl:"https://github.com/hwchase17/langchainjs/docs/modules/chains/index_related_chains/conversational_retrieval.mdx",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Index Related Chains",permalink:"/langchainjs/docs/modules/chains/index_related_chains/"},next:{title:"Document QA Chains",permalink:"/langchainjs/docs/modules/chains/index_related_chains/document_qa"}},h={},u=[],d={toc:u},p="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"conversationalretrievalqachain"},(0,i.kt)("inlineCode",{parentName:"h1"},"ConversationalRetrievalQAChain")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"ConversationalRetrievalQA")," chain builds on ",(0,i.kt)("inlineCode",{parentName:"p"},"RetrievalQAChain")," to provide a chat history component."),(0,i.kt)("p",null,"It requires two inputs: a question and the chat history. It first combines the chat history and the question into a standalone question, then looks up relevant documents from the retriever, and then passes those documents and the question to a question answering chain to return a response."),(0,i.kt)("p",null,'To create one, you will need a retriever. In the below example, we will create one from a vectorstore, which can be created from embeddings.\nimport Example from "@examples/chains/conversational_qa.ts";'),(0,i.kt)(o.Z,{language:"typescript",mdxType:"CodeBlock"},r),(0,i.kt)("p",null,"In this code snippet, the fromLLM method of the ",(0,i.kt)("inlineCode",{parentName:"p"},"ConversationalRetrievalQAChain")," class has the following signature:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"static fromLLM(\n  llm: BaseLanguageModel,\n  retriever: BaseRetriever,\n  options?: {\n    questionGeneratorTemplate?: string;\n    qaTemplate?: string;\n    returnSourceDocuments?: boolean;\n  }\n): ChatVectorDBQAChain\n")),(0,i.kt)("p",null,"Here's an explanation of each of the attributes of the options object:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"questionGeneratorTemplate"),": A string that specifies a question generation template. If provided, the ",(0,i.kt)("inlineCode",{parentName:"li"},"ConversationalRetrievalQAChain")," will use this template to generate a question from the conversation context, instead of using the question provided in the question parameter. This can be useful if the original question does not contain enough information to retrieve a suitable answer."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"qaTemplate"),": A string that specifies a response template. If provided, the ",(0,i.kt)("inlineCode",{parentName:"li"},"ConversationalRetrievalQAChain")," will use this template to format a response before returning the result. This can be useful if you want to customize the way the response is presented to the end user."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"returnSourceDocuments"),": A boolean value that indicates whether the ",(0,i.kt)("inlineCode",{parentName:"li"},"ConversationalRetrievalQAChain")," should return the source documents that were used to retrieve the answer. If set to true, the documents will be included in the result returned by the call() method. This can be useful if you want to allow the user to see the sources used to generate the answer. If not set, the default value will be false.")),(0,i.kt)("p",null,"In summary, the ",(0,i.kt)("inlineCode",{parentName:"p"},"questionGeneratorTemplate"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"qaTemplate"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"returnSourceDocuments")," options allow the user to customize the behavior of the ",(0,i.kt)("inlineCode",{parentName:"p"},"ConversationalRetrievalQAChain")))}m.isMDXComponent=!0}}]);